# 8. 系统设置开发

## 需求描述
点击 header.vue 的设置按钮后，需要弹框打开系统设置界面，以下项需要设置：
1. 设置数据存储的位置（即系统配置的yaml文件路径）
2. 设置主题（亮色/暗色）

## 开发状态：已完成

## 实现方案

### 后端实现

#### 1. 新增配置命令模块 (`src-tauri/src/commands/settings.rs`)

- `get_data_path` - 获取当前数据存储路径
- `migrate_data_path` - 迁移数据到新位置（支持迁移/不迁移选项）
- `select_data_folder` - 打开文件夹选择对话框

#### 2. 存储模块改进 (`src-tauri/src/db/mod.rs`)

- 新增 `AppConfig` 结构体用于存储自定义配置
- `Storage::new` 方法现在会检查 `config.yaml` 中的自定义数据路径
- 新增 `get_file_path` 方法返回实际使用的数据路径

#### 3. 依赖添加

- 添加 `tauri-plugin-dialog` 用于文件夹选择对话框

### 前端实现

#### 1. 设置对话框组件 (`src/components/settings/SettingsDialog.vue`)

功能特性：
- 主题切换：使用 el-radio-group 实现亮色/暗色切换，支持实时预览
- 数据存储路径显示：显示当前数据文件路径，支持复制到剪贴板
- 更改存储位置：打开文件夹选择对话框，选择新的存储目录
- 迁移选项：更改位置时提供"迁移数据"或"仅更改路径"两种选择

#### 2. 事件链集成

```
Header.vue (设置按钮点击)
    ↓ emit('settings')
AppLayout.vue
    ↓ emit('settings')
App.vue
    ↓ showSettingsDialog = true
SettingsDialog.vue (显示)
```

## 文件变更列表

### 新增文件
- `src-tauri/src/commands/settings.rs` - 后端设置命令
- `src/components/settings/SettingsDialog.vue` - 前端设置对话框

### 修改文件
- `src-tauri/Cargo.toml` - 添加 tauri-plugin-dialog 依赖
- `src-tauri/src/commands/mod.rs` - 注册 settings 模块
- `src-tauri/src/db/mod.rs` - 添加自定义路径加载逻辑
- `src-tauri/src/lib.rs` - 注册新命令和 dialog 插件
- `src/App.vue` - 集成 SettingsDialog
- `src/components/layout/AppLayout.vue` - 传递 settings 事件
- `src/components/layout/Header.vue` - 发出 settings 事件

## 使用说明

1. 点击右上角设置图标打开系统设置
2. 主题设置：选择亮色或暗色模式，立即生效
3. 数据存储：
   - 查看当前数据文件路径
   - 点击"复制路径"复制到剪贴板
   - 点击"更改位置"选择新目录
   - 选择"迁移数据"或"仅更改路径"
   - 重启应用后生效
